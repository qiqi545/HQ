<Project Sdk="Microsoft.NET.Sdk">

  <Import Project="$(ProjectDir)..\..\build\package.props" />
  <Import Project="$(ProjectDir)..\..\build\build.props" />
  <Import Project="$(ProjectDir)..\..\build\version.props" />

  <PropertyGroup Condition="'$(Configuration)'=='PackageSources'">
    <Description>This package contains unit test sources for HQ.io.</Description>
  </PropertyGroup>

  <PropertyGroup>
    <TargetFramework>netcoreapp2.2</TargetFramework>
    <Configurations>Debug;Release;PackageSources</Configurations>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
    <DefineConstants>TRACE;PLATFORM</DefineConstants>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <TieredCompilation>true</TieredCompilation>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.Azure.Functions.Extensions" Version="1.0.0" />
    <PackageReference Include="Microsoft.NET.Test.Sdk" Version="16.2.0" />
    <PackageReference Include="xunit" Version="2.4.1" />
    <PackageReference Include="xunit.runner.visualstudio" Version="2.4.1">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
    </PackageReference>
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\src\HQ\HQ.csproj" />
  </ItemGroup>

  <ItemGroup Condition="'$(Configuration)'!='PackageSources' AND '$(Configuration)'!='Package'">

    <!-- Test Framework -->
    <Content Include="..\..\src\HQ.Test.Sdk.Data\**\*.cs" Exclude="..\..\src\HQ.Test.Sdk.Data\obj\**\*" Link="Test.Sdk.Data\%(RecursiveDir)%(Filename)%(Extension)" />
    <Content Include="..\..\src\HQ.Test.Sdk\**\*.cs" Exclude="..\..\src\HQ.Test.Sdk\obj\**\*" Link="Test.Sdk\%(RecursiveDir)%(Filename)%(Extension)" />

    <!-- Common -->
    <Content Include="..\HQ.Common.Tests\**\*.cs" Exclude="..\HQ.Common.Tests\obj\**\*" Link="Common\%(RecursiveDir)%(Filename)%(Extension)" />
    
    <!-- Platform -->
    <Content Include="..\HQ.Platform.Security.Tests\**\*.cs" Exclude="..\HQ.Platform.Security.Tests\obj\**\*" Link="Platform.Security\%(RecursiveDir)%(Filename)%(Extension)" />


  </ItemGroup>
  
  <Target Name="MergeLinkedSource" BeforeTargets="Build" Condition="'$(Configuration)'!='Package'">
    <Copy SourceFiles="%(Content.Identity)" DestinationFiles="%(Content.Link)" SkipUnchangedFiles="true" OverwriteReadOnlyFiles="true" Condition="'%(Content.Link)' != ''" />
  </Target>

</Project>
